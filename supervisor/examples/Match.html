

<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
    Short Stadistic
  </title>
  <!-- Favicon -->
  <link href="../assets/img/brand/favicon.png" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="../assets/fonts/css.css" rel="stylesheet">
  <!-- Icons -->
  <link href="../assets/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
  <link href="../assets/js/plugins/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="../assets/css/argon-dashboard.css?v=1.1.2" rel="stylesheet" />
</head>
<style>
  .card {
    border-radius: 8px;
    margin: 10px 0;
    padding: 10px;
  }

  .card-header {
    font-size: 16px;
    font-weight: bold;
    padding: 8px;
  }

  .card-body {
    font-size: 14px;
    padding: 8px;
    line-height: 1.4;
  }

  .card p {
    margin: 4px 0;
  }

  .compact-card {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .card-header h4 {
    margin: 0;
  }

  .col-md-6 {
    padding: 5px; /* Reduce spacing between columns */
  }
</style>

<body class="">
  <nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main">
    <div class="container-fluid">
      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Brand -->
      <a class="navbar-brand pt-0" href="../index.html">
        <img src="../assets/img/brand/blue.png" class="navbar-brand-img" alt="...">
      </a>
      <!-- User -->
      <ul class="nav align-items-center d-md-none">

        <li class="nav-item dropdown">
          <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <div class="media align-items-center">
              <span class="avatar avatar-sm rounded-circle">
                <img alt="Image placeholder" src="../assets/img/theme/team-4-800x800.jpg
">
              </span>
            </div>
          </a>
          <!--<div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
            <div class=" dropdown-header noti-title">
              <h6 class="text-overflow m-0">Welcome!</h6>
            </div>

            <div class="dropdown-divider"></div>
            <a href="./logout.html" class="dropdown-item">
              <i class="ni ni-user-run"></i>
              <span>Logout</span>
            </a>
          </div> -->
        </li>
      </ul>
      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidenav-collapse-main">
        <!-- Collapse header -->
        <div class="navbar-collapse-header d-md-none">
          <div class="row">
            <div class="col-6 collapse-brand">
              <a href="../index.html">
                <img src="../assets/img/brand/blue.png">
              </a>
            </div>
            <div class="col-6 collapse-close">
              <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle sidenav">
                <span></span>
               
              </button>
            </div>
          </div>
        </div>
        <!-- Form -->
        <form class="mt-4 mb-3 d-md-none">
          <div class="input-group input-group-rounded input-group-merge">
            <input type="search" class="form-control form-control-rounded form-control-prepended" placeholder="Search" aria-label="Search">
            <div class="input-group-prepend">
              <div class="input-group-text">
                <span class="fa fa-search"></span>
              </div>
            </div>
          </div>
        </form>
        <!-- Navigation -->
        <ul class="navbar-nav">
          <li class="nav-item   ">
            <a class="nav-link   " href="../index.html">
              <i class="ni ni-tv-2 text-primary"></i> Dashboard
            </a>
          </li>

          <li class="nav-item ">
            <a class="nav-link  " href="./Productos.html">
              <i class="fa fa-link  text-info"></i> All Products
            </a>
          </li>


          <li class="nav-item active">
            <a class="nav-link  " href="./Match.html">
              <i class="fas fa-chart-bar text-red"></i> Match
            </a>
          </li>


        </ul>
        <!-- Divider -->
        <hr class="my-3">

      </div>
    </div>
  </nav>
  <div class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">
        <!-- Brand -->
        <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="">Match</a>


        <!-- User -->
        <ul class="navbar-nav align-items-center d-none d-md-flex">
          <li class="nav-item dropdown">
            <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle">
                  <img alt="Image placeholder" src="../assets/img/theme/team-4-800x800.jpg">
                </span>
                <div class="media-body ml-2 d-none d-lg-block">
                  <span id="user_name" class="mb-0 text-sm  font-weight-bold">Supervisor</span>
                </div>
              </div>
            </a>
           <!-- <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
              <div class=" dropdown-header noti-title">
                <h6 class="text-overflow m-0">Welcome!</h6>
              </div>

              <div class="dropdown-divider"></div>
              <a href="./logout.html" class="dropdown-item">
                <i class="ni ni-user-run"></i>
                <span>Logout</span>
              </a>
            </div> -->
          </li>
        </ul>
      </div>
    </nav>
    <!-- End Navbar -->
    <!-- Header -->
    <div class="header bg-gradient-indigo pb-8 pt-5 pt-md-8">
      <div class="container-fluid">
        <div class="header-body">
  



        </div>
      </div>
    </div>
    <div class="container-fluid mt--7">
      <!--  -->
      <div class="row">
        <div class="col-12 col-lg-12 mb-5">
          <div class="card shadow">
            <div class="card-header border-0 ">
                <div class="card-header border-0 d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Match</h3>
                    <button id="btnActualizar" class="btn btn-info">Actualizar</button>
                  </div>
            </div>
            <div id="cards-container" class="mt-3 row">
                <!-- Aquí se generarán las tarjetas dinámicamente -->
              </div>
          </div>
        </div>



      </div>


    </div>



  </div>
  <script>
    var datos_almacenados = JSON.parse(localStorage.getItem('datos_user'));
    if (datos_almacenados==null || datos_almacenados == undefined || datos_almacenados == '') {
     
    }else{

    }

  </script>
  <!--   Core   -->
  <script src="../assets/js/plugins/jquery/dist/jquery.min.js"></script>

  <script src="../assets/js/plugins/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <!--   Optional JS   -->
  <script src="../assets/js/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
  <!--   Argon JS   -->
  <script src="../assets/js/argon-dashboard.min.js?v=1.1.2"></script>
  <script src="../assets/js/plugins/c3/d3-v5.js"></script>
  <script src="../assets/js/plugins/c3/c3.min.js"></script>
  <link href="../assets/js/plugins/c3/c3.css" media="screen" rel="stylesheet" type="text/css" />

  <script type="text/javascript">
// Referencia al botón Actualizar

const updateButton = document.getElementById('btnActualizar');
document.addEventListener('DOMContentLoaded', () => {
  fetchUpdate(); // Ejecuta la función cuando la página termine de cargarse
});

// Función para manejar la solicitud fetch al presionar "Actualizar"
async function fetchUpdate() {
  // URL del servidor Node-RED
  const apiUrl = 'http://108.175.12.143:1880/match'; // Ajusta la URL según tu configuración

  try {
    const response = await fetch(apiUrl);
    const data = await response.json();

    console.log("Datos actualizados:", data);
    renderCards(data); // Llama a la función para mostrar las tarjetas
  } catch (error) {
    console.error("Error al obtener datos de actualización:", error);
  }
}

// Evento al presionar el botón "Actualizar"
updateButton.addEventListener('click', fetchUpdate);

// Función para renderizar las tarjetas
function renderCards(data) {
  const cardsContainer = document.getElementById('cards-container');
  cardsContainer.innerHTML = ''; // Limpia el contenedor antes de agregar nuevas tarjetas

  data.forEach((item, index) => {
    const missing = item.missing;
    const extra = item.extra;

    const card = `
      <div class="col-md-6">
        <div class="card compact-card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4>Missing</h4>
            <p class="mb-0" ><strong>ID:</strong> ${missing.id}</p>
        </div>

          <div class="card-body">
            <p><strong>Order Number:</strong> ${missing.order_number}</p>
            <p><strong>Paker:</strong> ${missing.paker}</p>
            <p><strong>Picking:</strong> ${missing.picking}</p>
            <p><strong>Location:</strong> ${missing.location}</p>
            <p><strong>Quantity Missing:</strong> ${missing.quantity_missing}</p>
            <p><strong>Station:</strong> ${missing.station}</p>
            <p><strong>Date Reported:</strong> ${new Date(missing.date_reported).toLocaleString()}</p>
            <p><strong>Item ID:</strong> ${missing.item_id}</p>
            <p><strong>SKU:</strong> ${missing.SKU}</p>
            
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card compact-card shadow-sm">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
            <h4>Extras</h4>
            <p class="mb-0" ><strong>ID:</strong> ${extra.id}</p>
        </div>
          <div class="card-body">
            <p><strong>Order Number:</strong> ${extra.order_number}</p>
            <p><strong>Paker:</strong> ${extra.paker}</p>
            <p><strong>Picking:</strong> ${extra.picking}</p>
            <p><strong>Location:</strong> ${extra.location}</p>
            <p><strong>Quantity Extras:</strong> ${extra.quantity_extras}</p>
            <p><strong>Station:</strong> ${extra.station}</p>
            <p><strong>Date Reported:</strong> ${new Date(extra.date_reported).toLocaleString()}</p>
            <p><strong>Item ID:</strong> ${extra.item_id}</p>
            <p><strong>SKU:</strong> ${extra.SKU}</p>
          </div>
        </div>
      </div>
      <div class="col-12 text-right">
        <button class="btn btn-sm btn-primary mt-2" onclick="markAsCompleted(${extra.id}, ${missing.id})">Mark as Completed</button>
      </div>
    `;
    cardsContainer.innerHTML += card;
  });
}

// Función para manejar el clic en "Mark as Completed"
async function markAsCompleted(extra_id, missing_id) {
  const apiUrl = 'http://108.175.12.143:1880/complete'; // URL del servidor Node-RED
 console.log(extra_id, missing_id);
 
  try {
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        missing_id: missing_id,
        extra_id: extra_id,
      }),
    });

    if (response.ok) {
      alert('Marked as completed successfully!');
      // Opcional: Actualizar la interfaz para reflejar el cambio
      fetchUpdate(); // Vuelve a cargar los datos
    } else {
      alert('Failed to mark as completed.');
    }
  } catch (error) {
    console.error('Error marking as completed:', error);
    alert('Error sending data to server.');
  }
}



  </script>
</body>
</html>
