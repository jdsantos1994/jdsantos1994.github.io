<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
    Productos
  </title>
  <!-- Favicon -->
  <link href="../assets/img/brand/favicon.png" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="../assets/fonts/css.css" rel="stylesheet">
  <!-- Icons -->
  <link href="../assets/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
  <link href="../assets/js/plugins/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="../assets/css/argon-dashboard.css?v=1.1.2" rel="stylesheet" />
</head>

<body class="">
  <nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main">
    <div class="container-fluid">
      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Brand -->
      <a class="navbar-brand pt-0" href="../index.html">
        <img src="../assets/img/brand/blue.png" class="navbar-brand-img" alt="...">
      </a>
      <!-- User -->
      <ul class="nav align-items-center d-md-none">

        <li class="nav-item dropdown">
          <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <div class="media align-items-center">
              <span class="avatar avatar-sm rounded-circle">
                <img alt="Image placeholder" src="../assets/img/theme/team-4-800x800.jpg">
              </span>
            </div>
          </a>
          <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
            <div class=" dropdown-header noti-title">
              <h6 class="text-overflow m-0">Welcome!</h6>
            </div>
            <a href="../examples/profile.html" class="dropdown-item">
              <i class="ni ni-single-02"></i>
              <span>My profile</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="./logout.html" class="dropdown-item">
              <i class="ni ni-user-run"></i>
              <span>Logout</span>
            </a>
          </div>
        </li>
      </ul>
      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidenav-collapse-main">
        <!-- Collapse header -->
        <div class="navbar-collapse-header d-md-none">
          <div class="row">
            <div class="col-6 collapse-brand">
              <a href="../index.html">
                <img src="../assets/img/brand/blue.png">
              </a>
            </div>
            <div class="col-6 collapse-close">
              <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle sidenav">
                <span></span>
                <span></span>
              </button>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <ul class="navbar-nav">
          <li class="nav-item   ">
            <a class="nav-link   " href="../index.html">
              <i class="ni ni-tv-2 text-primary"></i> Dashboard
            </a>
          </li>


          <li class="nav-item active">
            <a class="nav-link active " href="./Productos.html">
              <i class="fa fa-link  text-info"></i> Productos
            </a>
          </li>

          <li class="nav-item ">
            <a class="nav-link  " href="./Match.html">
              <i class="fas fa-chart-bar text-red"></i> Match
            </a>
          </li>


        </ul>
        <!-- Divider -->
        <hr class="my-3">
        <!-- Heading -->

      </div>
    </div>
  </nav>
  <div class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">
        <!-- Brand -->
        <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="./Productos.html">Productos</a>
        <!-- Form -->

        <!-- User -->
        <ul class="navbar-nav align-items-center d-none d-md-flex">
          <li class="nav-item dropdown">
            <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle">
                  <img alt="Image placeholder" src="../assets/img/theme/team-4-800x800.jpg">
                </span>
                <div class="media-body ml-2 d-none d-lg-block">
                  <span id="user_name" class="mb-0 text-sm  font-weight-bold">Station </span>
                </div>
              </div>
            </a>
            <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
              <div class=" dropdown-header noti-title">
                <h6 class="text-overflow m-0">Welcome!</h6>
              </div>


              <div class="dropdown-divider"></div>
              <a href="./logout.html" class="dropdown-item">
                <i class="ni ni-user-run"></i>
                <span>Logout</span>
              </a>
            </div>
          </li>
        </ul>
      </div>
    </nav>
    <!-- End Navbar -->
    <!-- Header -->
    <div class="header bg-gradient-info pb-8 pt-5 pt-md-8">
      <div class="container-fluid">
        <div class="header-body">
          <!-- Card stats -->
          <div class="row justify-content-around">





          </div>

        </div>
      </div>
    </div>



    <!-- Page content -->
    <div class="container-fluid mt--7">
      <!-- Table -->
      <div class="row">
        <div class="col">
          <div class="card shadow">
            <div class="card-header bg-transparent">
              <h3 class="mb-0">Productos</h3>
            </div>
             <!-- Form buscar-->



            <div class="card-body ">

              <div class="input-group input-group-rounded input-group-merge">
                <input id="inputbuscar" type="search" class="form-control form-control-rounded form-control-prepended" placeholder="Search" aria-label="Search">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <span class="fa fa-search"></span>
                  </div>
                </div>
                <div class="input-group-append">
                  <button id="btnBuscar" class="btn btn-primary" type="button">Buscar</button>
                </div>
              </div>
              

            </div>



            <div class="card-body">

                      <div style="max-height: 50em;  min-height: 13em" class="table-responsive mt-4">
                        <!-- Projects table -->
                        <div class="table-responsive">
                          <table class="table align-items-center">
                            <thead>
                              <tr>
                                <th scope="col">Item ID</th>
                                <th scope="col">SKU</th>
                                <th scope="col">Description</th>
                              </tr>
                            </thead>
                            <tbody id="table-body">
                              <!-- Aquí se llenarán las filas dinámicamente -->
                            </tbody>
                          </table>
                        </div>
                        
                      </div>
                      <div id="pagination-container" class="mt-3"></div>

              </div>
            </div>
          </div>
        </div>
      </div>
  
    </div>
  </div>
  <!--   Core   -->
  <script>

    var datos_almacenados = JSON.parse(localStorage.getItem('datos_user'))
    if (
      datos_almacenados == null ||
      datos_almacenados == undefined ||
      datos_almacenados == ''
    ) {
      location.href = './examples/login.html'
    } else {
      document.querySelector('#user_name').innerHTML +=
        datos_almacenados.Station
    }
  </script>
  <script src="../assets/js/plugins/jquery/dist/jquery.min.js"></script>
  <script src="../assets/js/plugins/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <!--   Optional JS   -->
  <script src="../assets/js/plugins/clipboard/dist/clipboard.min.js"></script>
  <!--   Argon JS   -->
  <script src="../assets/js/argon-dashboard.min.js?v=1.1.2"></script>
  <script src="https://cdn.trackjs.com/agent/v3/latest/t.js"></script>

  <!--   Ordena Tablas   -->
  <script>
   const apiUrl = 'http://localhost:1880/get-data'; // Cambia según tu configuración

let currentPage = 1;
let pageSize = 50;
fetchData(currentPage, pageSize);

async function fetchData(page, size) {
  try {
    const response = await fetch(`${apiUrl}?page=${page}&size=${size}`);
    const data = await response.json();
    console.log(data);
    
    renderTable(data.items);
    renderPagination(data.totalPages, page);
  } catch (error) {
    console.error('Error fetching data:', error);
  }
}

function renderTable(items) {
  const tableBody = document.getElementById('table-body');
  tableBody.innerHTML = '';

  items.forEach(item => {
    const row = `
      <tr>
        <td>${item.item_id}</td>
        <td>${item.sku}</td>
        <td>${item.description}</td>
      </tr>`;
    tableBody.innerHTML += row;
  });
}

function renderPagination(totalPages, currentPage) {
  const paginationContainer = document.getElementById('pagination-container');
  const maxVisibleButtons = 5; // Número máximo de botones visibles
  let paginationHTML = `
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
          <a class="page-link" href="#" onclick="changePage(1)">
            <i class="fa fa-angle-double-left"></i>
          </a>
        </li>
        <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
          <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">
            <i class="fa fa-angle-left"></i>
          </a>
        </li>`;

  // Calcular el rango de páginas visibles
  const startPage = Math.max(1, currentPage - Math.floor(maxVisibleButtons / 2));
  const endPage = Math.min(totalPages, startPage + maxVisibleButtons - 1);

  for (let i = startPage; i <= endPage; i++) {
    paginationHTML += `
      <li class="page-item ${i === currentPage ? 'active' : ''}">
        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
      </li>`;
  }

  paginationHTML += `
        <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
          <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
        <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
          <a class="page-link" href="#" onclick="changePage(${totalPages})">
            <i class="fa fa-angle-double-right"></i>
          </a>
        </li>
      </ul>
    </nav>`;
  paginationContainer.innerHTML = paginationHTML;
}


function changePage(page) {
  currentPage = page;
  fetchData(currentPage, pageSize);
}

// Inicializa la tabla
fetchData(currentPage, pageSize);

const searchInput = document.getElementById('inputbuscar');
const searchButton = document.getElementById('btnBuscar');


// Función para realizar el fetch
async function fetchSearchResults() {
  const query = searchInput.value.trim(); // Captura el valor del input y elimina espacios
  // URL del servidor Node-RED
  const apiUrl = 'http://localhost:1880/search'; // Ajusta la URL según tu configuración

  if (!query) {
    alert("Por favor, ingresa un término de búsqueda.");
    return;
  }

  try {
    const response = await fetch(`${apiUrl}?q=${encodeURIComponent(query)}`);
    const data = await response.json();

    console.log("Resultados de búsqueda:", data);
    renderSearchResults(data); // Llama a una función para renderizar los resultados
  } catch (error) {
    console.error("Error al buscar:", error);
  }
}

// Evento para ejecutar la búsqueda al presionar el botón
searchButton.addEventListener('click', fetchSearchResults);

// Función para renderizar los resultados (ajústala según tu tabla)
function renderSearchResults(items) {
  const tableBody = document.getElementById('table-body'); // Asegúrate de tener una tabla
  tableBody.innerHTML = ''; // Limpia los resultados anteriores

  items.forEach(item => {
    const row = `
      <tr>
        <td>${item.item_id}</td>
        <td>${item.sku}</td>
        <td>${item.description}</td>
      </tr>`;
    tableBody.innerHTML += row;
  });
}



</script>
</body>

</html>
